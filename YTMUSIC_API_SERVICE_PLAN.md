# YouTube Music API Service Plan

This document outlines the plan to create a Python-based backend service that uses `ytmusicapi` to provide YouTube Music data to the Mirei Flutter app.

## 1. Architecture

The solution consists of two main components:

1.  **Python Backend (FastAPI Server)**:
    *   A web server built with FastAPI.
    *   Uses the `ytmusicapi` library for all interactions with YouTube Music.
    *   Handles OAuth 2.0 authentication flow.
    *   Exposes a REST API for the Flutter app to consume.

2.  **Flutter App (Client)**:
    *   The existing Mirei application.
    *   The `YouTubeMusicService` will be updated to make HTTP requests to the Python backend.
    *   It will use a package like `http` to communicate with the API.
    *   It will use `url_launcher` to open a browser for the OAuth login page served by the backend.

## 2. Backend Setup

### Directory Structure

A new `backend` directory will be created at the root of the project:

```
/
|-- backend/
|   |-- main.py         # The main FastAPI application
|   |-- requirements.txt  # Python dependencies
|   |-- oauth.json        # To store OAuth credentials (generated by ytmusicapi)
|-- lib/
|-- ...
```

### API Endpoints

The backend will expose the following endpoints:

*   `GET /search?query=<search_term>`: Searches for music.
*   `GET /auth/url`: Gets the Google OAuth URL.
*   `GET /auth/callback?code=<code>`: Handles the callback from Google.
*   `GET /library/playlists`: Gets the authenticated user's playlists.
*   `GET /library/liked`: Gets the authenticated user's liked songs.
*   `GET /stream_url?videoId=<video_id>`: Gets the streaming URL for a song.

## 3. Flutter App Modifications

*   **`pubspec.yaml`**: Add `http` and `url_launcher` packages. Remove `yt_flutter_musicapi`.
*   **`lib/services/youtube_music_service.dart`**: This service will be completely rewritten to call the new backend API endpoints.
*   **`lib/bloc/youtube_music_bloc.dart`**: The BLoC will be updated to reflect the new asynchronous methods of the service, especially for authentication.

## 4. Implementation Steps

1.  Create the `backend` directory and initial Python files (`main.py`, `requirements.txt`).
2.  Add the necessary dependencies to `pubspec.yaml`.
3.  Rewrite `youtube_music_service.dart` to fetch data from the backend.
4.  Implement the UI for the authentication flow.
5.  Provide instructions for running the backend server locally for development.
